
<!--more-->

![QQ图片20210329104045.png](https://i.loli.net/2021/03/29/jOkZgWiGL9upbFy.png)







先考虑只有一组查询的情况。

考虑分治，分别求出$[l,mid],[mid,r]$两个区间满足条件的区间个数，这显然可以`two pointer`扫。

然后考虑两个区间合并，即跨过中点的合法区间个数。

可以第一次枚举前者的后缀来移动后者，第二次枚举后者的前缀来枚举前者。

复杂度为$O(n\log n)$.

考虑放到线段树上，每一个节点记录前缀和后缀中与其上一个的`|`和不同的节点位置和对应`|`和，显然每一个节点上的这些东西不会超过$\log$个，所以可以直接暴力做。

